sequenceDiagram
    %% Participants
    actor TA as Tenant Admin ðŸŽŸï¸
    participant UI as User Interface ðŸ–¥ï¸
    participant SS as Subscription Service ðŸ“
    participant PS as Plan Service ðŸ“‹
    participant BS as Billing Service ðŸ’³
    participant PG as Payment Gateway ðŸ¦
    participant TS as Tenant Service ðŸ¢
    participant FS as Feature Service ðŸ”§
    participant NS as Notification Service ðŸ“§
    
    autonumber
    
    %% Interactions
    TA->>+UI: View Available Subscription Plans
    UI->>+PS: Get Available Plans
    PS-->>-UI: Return Plan Options
    UI-->>-TA: Display Available Plans
    
    TA->>+UI: Select Plan & Payment Method
    UI->>+SS: Request Subscription Change
    
    SS->>+PS: Validate Plan Details
    PS-->>-SS: Plan Details Validated
    
    SS->>+BS: Create Billing Record
    BS->>BS: Calculate Prorated Amount
    BS->>+PG: Process Payment
    PG->>PG: Authorize Payment
    PG-->>-BS: Payment Authorized
    BS-->>-SS: Billing Record Created
    
    SS->>+TS: Update Tenant Subscription
    TS->>TS: Update Subscription Status
    TS-->>-SS: Tenant Subscription Updated
    
    SS->>+FS: Apply Feature Access
    FS->>FS: Update Feature Flags
    FS->>FS: Set Usage Limits
    FS-->>-SS: Feature Access Applied
    
    SS->>+NS: Send Subscription Confirmation
    NS->>NS: Generate Confirmation
    NS-->>TA: Send Confirmation Email
    NS-->>-SS: Notification Sent
    
    SS-->>-UI: Subscription Updated Successfully
    UI-->>-TA: Display Confirmation
    
    %% Renewal Flow
    Note over TA,NS: Before Subscription Expiry
    
    SS->>SS: Detect Upcoming Renewal
    SS->>+NS: Send Renewal Reminder
    NS-->>TA: Send Renewal Notification
    NS-->>-SS: Reminder Sent
    
    SS->>+BS: Generate Renewal Invoice
    BS->>BS: Calculate Renewal Amount
    BS->>+PG: Process Automatic Payment
    PG-->>-BS: Payment Processed
    BS-->>-SS: Invoice Paid
    
    SS->>+TS: Extend Subscription Period
    TS-->>-SS: Subscription Extended
    
    SS->>+NS: Send Renewal Confirmation
    NS-->>TA: Send Confirmation Email
    NS-->>-SS: Notification Sent
